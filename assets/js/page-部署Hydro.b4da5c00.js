(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{526:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"部署-hydro"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署-hydro"}},[t._v("#")]),t._v(" 部署 Hydro")]),t._v(" "),a("p",[t._v("本页面将指导您部署 Hydro。 请根据您的实际情况选择。\n这里提供了几套方案帮助您建立自己的站点，请选择适合您的方案并继续。"),a("br"),t._v("\n搭建过程中如果遇到问题欢迎 "),a("RouterLink",{attrs:{to:"/#联系我们"}},[t._v("联系我们")]),t._v(" 提问。")],1),t._v(" "),a("h2",{attrs:{id:"服务器选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器选择"}},[t._v("#")]),t._v(" 服务器选择")]),t._v(" "),a("p",[t._v("不同服务商提供的 CPU 主频不同，下方数据仅供参考。"),a("br"),t._v("\n最低服务器配置： CPU: 1核 内存: 1G 硬盘: 20G。（约可允许50人同时使用）"),a("br"),t._v("\n推荐服务器配置： CPU: 1核 内存: 2G 硬盘: 30G。（约可允许150人同时使用）"),a("br"),t._v(" "),a("strong",[t._v("请尽量不要使用突发性能实例或共享型实例，这可能会导致评测时间计量不准确")])]),t._v(" "),a("h2",{attrs:{id:"使用安装脚本搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用安装脚本搭建"}},[t._v("#")]),t._v(" 使用安装脚本搭建")]),t._v(" "),a("p",[a("strong",[t._v("运行前需要切换到 root 用户！ （ "),a("code",[t._v("sudo su")]),t._v(" ）")]),t._v("。")]),t._v(" "),a("p",[t._v("目前支持以下操作系统：")]),t._v(" "),a("ul",[a("li",[t._v("Ubuntu 16.04 LTS")]),t._v(" "),a("li",[t._v("Ubuntu 18.04 LTS")]),t._v(" "),a("li",[t._v("Ubuntu 20.04 LTS")]),t._v(" "),a("li",[t._v("Arch Linux")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tips")]),t._v(" "),a("p",[t._v("若您已安装宝塔面板，请先卸载或将其切换至其他端口。\n"),a("strong",[t._v("不建议您在生产环境使用宝塔面板")]),a("br"),t._v("\n自动安装脚本将会在您的机器上安装 MongoDB、MinIO、NodeJS。如果您的机器上已经安装过上述软件，建议您重置该系统或是进行 "),a("RouterLink",{attrs:{to:"/install/common.html"}},[t._v("常规安装")]),t._v("。")],1)]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://s3.undefined.moe/public/install "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ./install\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("完成后请阅读下方 "),a("a",{attrs:{href:"#%E5%88%9D%E5%A7%8B%E5%8C%96"}},[t._v("#初始化")]),t._v(" 部分。")]),t._v(" "),a("h2",{attrs:{id:"使用-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker"}},[t._v("#")]),t._v(" 使用 docker")]),t._v(" "),a("p",[t._v("仅推荐熟悉 docker 及 docker-compose 的用户使用。\n参照 https://github.com/hydro-dev/Hydro/blob/master/install/docker/README.md")]),t._v(" "),a("h2",{attrs:{id:"开发者模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发者模式"}},[t._v("#")]),t._v(" 开发者模式")]),t._v(" "),a("p",[a("strong",[t._v("安装依赖")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),a("p",[t._v("CentOS 的内核版本过于老旧，可能会导致沙箱安全性问题。")])]),t._v(" "),a("ul",[a("li",[t._v("MongoDB：Hydro 需要 "),a("a",{attrs:{href:"https://www.mongodb.com/try/download/community",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB"),a("OutboundLink")],1),t._v(" 提供数据库服务。")]),t._v(" "),a("li",[t._v("S3：可使用 "),a("a",{attrs:{href:"https://min.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("MinIO"),a("OutboundLink")],1),t._v(" 提供 S3 服务。")]),t._v(" "),a("li",[t._v("NodeJS：请安装 NodeJS >=14 版本。（勿使用 apt 安装 nodejs） （推荐使用 "),a("a",{attrs:{href:"https://nvm.sh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("nvm"),a("OutboundLink")],1),t._v("）")]),t._v(" "),a("li",[t._v("yarn：安装 yarn 前请先完成 NodeJS 安装。 "),a("code",[t._v("npm install -g yarn")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tips")]),t._v(" "),a("p",[t._v("腾讯COS、Amazon S3、wasabi 等也可提供 S3 服务。"),a("br"),t._v("\n暂不支持阿里OSS。")])]),t._v(" "),a("p",[a("strong",[t._v("安装Hydro")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" global "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" npx "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 npx 工具")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/hydro-dev/Hydro.git /root/Hydro --recursive "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载至 /root/Hydro 文件夹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/Hydro "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入工作目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装依赖包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译后端")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build:ui:production "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译前端")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[a("strong",[t._v("开发者模式指南")])]),t._v(" "),a("p",[t._v("支持如下启动参数：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("--port=8888")]),t._v(" 指定启动端口")]),t._v(" "),a("li",[a("code",[t._v("--debug")]),t._v(" 启用开发模式")]),t._v(" "),a("li",[a("code",[t._v("--ignorelock")]),t._v(" 忽略lockfile（不建议）")])]),t._v(" "),a("p",[t._v("您可以在后台运行 "),a("code",[t._v("yarn build:watch")]),t._v("，这将对后端源码进行实时转译，可在反复修改时节省编译时间。"),a("br"),t._v("\n您可以在后台运行 "),a("code",[t._v("yarn build:ui:dev")]),t._v("，这将对前端源码进行实时转译，可在反复修改时节省编译时间。"),a("br"),t._v("\n您可以使用 "),a("code",[t._v("yarn debug --port=2333")]),t._v(" 启动 Hydro，配合上述两个命令同时使用，您可以在 8000 端口访问到 Hydro 实例，且前端的任何更改将即时生效。（更改后端代码后仍需要重启 Hydro 才能生效）")]),t._v(" "),a("p",[t._v("首次启动会要求您填写数据库连接信息。请根据您数据库的安装填写（若无密码则留空）"),a("br"),t._v("\n出现 "),a("code",[t._v("Storage init fail")]),t._v(" 提示是正常现象。请按照下文说明创建管理员账户，在系统设置的 file 部分填写 S3 服务的连接信息后重启 Hydro 即可正常使用。")]),t._v(" "),a("h2",{attrs:{id:"初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),a("p",[t._v("安装完成后请先重启 bash。（关闭终端重新打开或是重新连接ssh）"),a("br"),t._v("\n请尝试通过 "),a("code",[t._v("http://服务器ip:8888/")]),t._v(" 访问 Hydro 并注册一个账号。"),a("br"),t._v("\n若您无法访问，请检查服务器防火墙/安全组是否放行了 8888 端口。")]),t._v(" "),a("p",[t._v("注册账号后，请在右上角下拉菜单找到个人信息，记住页面所显示的 UID。"),a("br"),t._v("\n在终端以 root 用户运行以下命令将用户设置为管理员：")]),t._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"常规部署",active:""}},[a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("hydrooj cli user setSuperAdmin "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("UID")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("CodeGroupItem",{attrs:{title:"开发者模式"}},[a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请在 Hydro 的安装文件夹内运行该命令")]),t._v("\nnpx hydrooj cli user setSuperAdmin "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("UID")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])])],1),t._v(" "),a("p",[t._v("之后刷新页面，您应当能在导航栏看到控制面板入口。"),a("br"),t._v("\n进入控制面板，右侧进入系统设置，填写如下内容：")]),t._v(" "),a("ul",[a("li",[t._v("Server Name: 您的 OJ 的名称。")]),t._v(" "),a("li",[t._v("Server BaseURL: 网站完整的 URL，需要以 "),a("code",[t._v("/")]),t._v(" 结尾。（重要，务必正确填写）")]),t._v(" "),a("li",[t._v("Server Port: Hydro 监听的端口。")]),t._v(" "),a("li",[t._v("IP Header: 若使用反向代理（含 Cloudflare 等 CDN 服务），请设置为其 IP Header（通常为 "),a("code",[t._v("x-forwarded-for")]),t._v(" 或 "),a("code",[t._v("x-real-ip")]),t._v("，小写）。在不使用反向代理的情况下请勿配置该项，否则用户将可以伪造 IP 。")]),t._v(" "),a("li",[t._v("Default display language: 网站默认语言。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tips")]),t._v(" "),a("p",[t._v("建议您完整浏览所有设置项并按需配置。（不知道是啥的别改，出问题了自行解决）")])]),t._v(" "),a("p",[t._v("Hydro 系统会不定期发布更新。")]),t._v(" "),a("CodeGroup",[a("CodeGroupItem",{attrs:{title:"常规部署",active:""}},[a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" global upgrade-interactive --latest\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("CodeGroupItem",{attrs:{title:"开发者模式"}},[a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请在 Hydro 的安装文件夹内运行该命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取更新")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译后端")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build:ui:production "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译前端")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])])],1)],1)}),[],!1,null,null,null);s.default=n.exports}}]);